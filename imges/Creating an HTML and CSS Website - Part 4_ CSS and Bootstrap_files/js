var evalkit_setup = { auth_external_tool_id: 29951, account_url: 'https://academyoflearning.evaluationkit.com', account_id: 69, deployment_id: null, auth_url: '/api/v1/accounts/69/external_tools/sessionless_launch?id=29951&url=https%3a%2f%2facademyoflearning.evaluationkit.com%2fCanvas%2fLti' };var evalkit_loaded=0,evalkit_isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor),evalkit_issafari=evalkit_isChrome||-1!==navigator.userAgent.indexOf("Safari")&&(-1===navigator.userAgent.indexOf("Chrome")||-1<navigator.userAgent.indexOf("Chrome")&&-1<navigator.userAgent.indexOf("OPR")),EvaluationKIT={onLoad:function(){var e,t;null===ENV.current_user_id||-1<window.location.href.indexOf("sessionless_launch")||-1<window.location.href.indexOf("display=borderless")||0===$("#dashboard").length&&0===$(".context_external_tool_"+evalkit_setup.auth_external_tool_id).length&&0===this.getPageCourseId()&&-1===document.location.href.indexOf("/profile")&&-1===document.location.href.indexOf("/grades")||3<(evalkit_loaded+=1)||(e=this.getTokenCookie(),t=this.getVerifyCookie(),0===e.length||t!==ENV.current_user_id?this.onLti():this.onUser(e))},onLti:function(){this.startInit(function(){(EvaluationKIT||{}).onAuth()})},startInit:function(n){var i=this,e=i.getInitCookie();null!==e&&!1===e||(null===e||!0!==e?$.get("/api/v1/users/self/profile",function(t){var e;0<t.login_id.length?0<(e=i.getPageCourseId())?$.get("/api/v1/courses/"+e,function(e){0<e.id?i.onAuthInit(t.id,t.login_id,t.integration_id,e.id,e.course_code,n):i.setInitCookie(!1)}):i.onAuthInit(t.id,t.login_id,t.integration_id,0,"",n):i.setInitCookie(!1)}):n())},onAuthInit:function(e,t,n,i,o,a){var l=this;$.get(evalkit_setup.account_url+"/Canvas/InitCheck?authId="+evalkit_setup.auth_external_tool_id+"&username="+encodeURIComponent(t)+"&userid="+e+"&integration_id="+encodeURIComponent(n)+"&coursecode="+encodeURIComponent(o)+"&courseid="+i+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&nocache="+(new Date).getTime(),function(e){l.setInitCookie(e.result),!1!==e.result&&a()})},onAuth:function(){var t;null===evalkit_setup.deployment_id?(t=this.createCORSRequest("GET",evalkit_setup.auth_url))&&(t.onload=function(){var e;200===t.status?(e=$.parseJSON(t.responseText.replace("while(1);","")),0<$("#evalkit-lti").length&&$("#evalkit-lti").remove(),$('<iframe src="'+e.url+'" id="evalkit-lti" style="display:none;"></iframe>').appendTo($("body"))):(EvaluationKIT||{}).onLoad()},t.send()):this.onAuth3()},onAuth3:function(){0<$("#evalkit-lti").length&&$("#evalkit-lti").remove(),$('<iframe src="'+evalkit_setup.auth_url+'" id="evalkit-lti" style="display:none;"></iframe>').appendTo($("body"))},onLtiResponse:function(e){if(null!==e.origin&&-1!==e.origin.toLowerCase().indexOf(evalkit_setup.account_url)&&null!==e.data&&void 0!==e.data.length){var t=EvaluationKIT||{},n=JSON.parse(e.data);if(null!==n)switch(n.subject){case"evalkit.location":window.top.location.href=n.url;break;case"evalkit.ltiresponse":var i=n.token;0===i.length&&(i="-1"),t.setTokenCookie(i),t.setVerifyCookie(ENV.current_user_id),t.onLoad()}else console.log("DEBUG: onLtiResponse - jsondata error")}},onUser:function(i){"-1"!==i&&this.startInit(function(){var e,t=EvaluationKIT||{},n=t.getPageCourseId();null===document.getElementById("ek_css")&&((e=document.createElement("link")).setAttribute("id","ek_css"),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",evalkit_setup.account_url+"/scripts/canvas/style.min.css"),document.getElementsByTagName("head")[0].appendChild(e)),0===n?t.getUserSettings(i,n,""):$.ajax({url:"/api/v1/courses/"+n,type:"GET",success:function(e){var t="";try{t=e.course_code}catch(e){(EvaluationKIT||{}).onError(e)}(EvaluationKIT||{}).getUserSettings(i,n,t)},error:function(e){var t=EvaluationKIT||{};t.onError(e),t.onLoad()}})})},getUserSettings:function(e,n,t){var i=this.createCORSRequest("GET",evalkit_setup.account_url+"/canvas/usersettings?token="+encodeURIComponent(e)+"&userid="+ENV.current_user_id+(0<n?"&courseid="+n+"&coursecode="+encodeURIComponent(t)+"&courseTitle=":"")+"&refer="+encodeURIComponent(window.location.pathname+window.location.search)+"&isSafari="+evalkit_issafari+"&nocache="+(new Date).getTime());i&&(i.onload=function(){if(401===i.status)(EvaluationKIT||{}).onLti();else try{var e=$.parseJSON(i.responseText),t=EvaluationKIT||{};t.onPopup(e),t.onWidget(e),t.onLinks(e,n),$(document).on("click",".ek-sessionless",function(e){var t,n=$(this).attr("href");evalkit_issafari?n=$(this).data("safariurl"):e.preventDefault(),null===evalkit_setup.deployment_id?(t=(EvaluationKIT||{}).createCORSRequest("GET",n))&&(t.onload=function(){var e;200===t.status&&void 0!==(e=$.parseJSON(t.responseText.replace("while(1);",""))).url&&null!==e&&0<e.url.length?ek_modal.open({iframelink:e.url,buttons:null,iframeheight:800,cssclass:"evalkit-modal-lg",showClose:!0,type:"notification"}):(EvaluationKIT||{}).onLti()},t.send()):ek_modal.open({iframelink:n,buttons:null,iframeheight:800,cssclass:"evalkit-modal-lg",showClose:!0,type:"notification"})})}catch(e){(EvaluationKIT||{}).onError(e)}},i.onerror=function(e){var t=EvaluationKIT||{};-1<navigator.appVersion.indexOf("MSIE 10")||-1<navigator.appVersion.indexOf("MSIE 9")?t.onLti():t.onError(e)},i.send())},onPopup:function(t){var e,n;!0===t.popup.visible&&(e=[],(n=document.createElement("a")).innerHTML=t.popup.gotosurveytext,-1<t.popup.gotosurveyurl.indexOf("sessionless_launch")||-1<t.popup.gotosurveyurl.indexOf("display=borderless")?(n.setAttribute("class","Button Button--primary ek-widget-btn-primary ek-sessionless"),evalkit_issafari?(n.setAttribute("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),n.setAttribute("data-safariurl",t.popup.gotosurveyurl),n.setAttribute("target","_blank")):n.setAttribute("href",t.popup.gotosurveyurl)):(n.setAttribute("class","Button Button--primary ek-widget-btn-primary"),n.setAttribute("href",t.popup.gotosurveyurl)),e[0]=n,t.popup.remindlater&&((n=document.createElement("a")).innerHTML=t.popup.remindlatertext,n.setAttribute("href","#"),n.setAttribute("class","Button ek-widget-btn-default"),!0===t.popup.incrementDefer?n.onclick=function(e){e.preventDefault(),ek_modal.close();e=EvaluationKIT||{};$.get(evalkit_setup.account_url+"/canvas/defer?token="+encodeURIComponent(e.getTokenCookie())+"&projectId="+t.popup.projectId+"&courseId="+t.popup.courseId+"&nocache="+(new Date).getTime())}:n.onclick=function(e){e.preventDefault(),ek_modal.close()},e[1]=n),ek_modal.open({title:t.popup.header,body:t.popup.body,buttons:e,showClose:!1,type:!0===t.popup.blockPage?"blocker":"notification"}))},onWidget:function(e){setTimeout(function(){$(e.widget).appendTo("#right-side"),evalkit_issafari&&null!==e.widget&&$(".ek-widget a").each(function(e){var t=$(this);t.hasClass("ek-sessionless")&&(t.attr("data-safariurl",t.attr("href")),t.attr("href",evalkit_setup.account_url+"/MyEval/CookieSet.aspx"),t.attr("target","_blank"))})},2e3)},onLinks:function(e,t){this.setLink(e.userlink,t),this.setLink(e.studentlink,t),this.setLink(e.instructorlink,t),this.setLink(e.talink,t),this.setLink(e.adminlink,t)},createCORSRequest:function(e,t){try{var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest).open(e,t):n=null,n}catch(e){this.onError(e)}},getPageCourseId:function(){return void 0!==$("body").attr("class")&&$("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)?parseInt($("body").attr("class").match(/\bcontext-course_(.[0-9]*)/)[1]):0},getPageUserId:function(){return $("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)?$("body").attr("class").match(/\bcontext-user_(.[0-9]*)/)[1]:""},getTokenCookie:function(){return evalkit_readCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id)||""},setTokenCookie:function(e){evalkit_createCookie("evalkit_token_"+evalkit_setup.auth_external_tool_id,e)},getVerifyCookie:function(){return evalkit_readCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id)||""},setVerifyCookie:function(e){evalkit_createCookie("evalkit_verify_"+evalkit_setup.auth_external_tool_id,e)},getInitCookie:function(){var e=evalkit_readCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id);if(null!==e&&""!==e||(e=-1),-1!==e&&e!==ENV.current_user_id)return evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id),evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,""),null;e=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id);if(null===e||""===e)return null;var t=this.getSection();if(null===t)return!1;for(var n=JSON.parse(e),i=0;i<n.length;i++)if(n[i].section===t)return n[i].val;return null},setInitCookie:function(e){var t=evalkit_readCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id);null!==t&&""!==t||(t="");var n=this.getSection();if(null!==n){for(var i=0===t.length?[]:JSON.parse(t),o=!1,a=0;a<i.length;a++)i[a].section===n&&(o=!0,i[a].val=e);!1===o&&i.push({section:n,val:e}),evalkit_createCookie("evalkit_init_verfiy_"+evalkit_setup.auth_external_tool_id,ENV.current_user_id),evalkit_createCookie("evalkit_init_"+evalkit_setup.auth_external_tool_id,JSON.stringify(i))}},getSection:function(){var e=null;return 0<$("#dashboard").length?e="dashboard":-1<document.location.href.indexOf("/profile")?e="profile":0<this.getPageCourseId()?e=this.getPageCourseId():-1<document.location.href.indexOf("/grades")&&(e="dashboard"),e},setLink:function(e){var t;null!==e&&null!==e.url&&(t=$("a.context_external_tool_"+e.exttoolid),e.visible?(0===t.length||t.hasClass("evalkit-ltilink")?($("<li class='section evalkitlink'><a style='display:block !important;' class='evalkit-ltilink ltilinkcontext_external_tool_"+e.exttoolid+"' href='"+e.url+"'>"+e.title+"</a></li>").appendTo("#section-tabs"),t=$("a.context_external_tool_"+e.exttoolid)):(t.attr("style","display: block !important;"),t.attr("href",e.url),e.title!==t.html()&&t.html(e.title)),null!==e.badge&&$('<b class="nav-badge evalkit-badge">'+e.badge+"</b>").prependTo(t),t.parent().show(),t.addClass("evalkit-ltilink")):t.hasClass("evalkit-ltilink")||t.parent().hide())},onError:function(e){}};$(document).ready(function(){var e=EvaluationKIT||{};window.addEventListener?window.addEventListener("message",e.onLtiResponse,!1):window.attachEvent("onmessage",e.onLtiResponse),e.onLoad()});var ek_modal=function(){var i,o,a,l,r,e={},s=document.createElement("div");s.id="ek-overlay",s.style.display="none",(i=document.createElement("div")).id="ek-modal",i.style.display="none",i.setAttribute("role","dialog"),i.setAttribute("tabindex","-1"),i.setAttribute("aria-live","assertive"),i.setAttribute("aria-labelledby","ek-modal-header");var t=document.createElement("div");return t.setAttribute("class","ek-modal-content"),(o=document.createElement("h2")).setAttribute("class","ek-modal-header"),o.id="ek-modal-header",(r=document.createElement("a")).setAttribute("id","ek-modal-close"),(a=document.createElement("div")).setAttribute("class","ek-modal-body"),a.setAttribute("id","ek-modal-body"),(l=document.createElement("div")).setAttribute("class","ek-modal-footer"),t.appendChild(o),t.appendChild(r),t.appendChild(a),t.appendChild(l),i.appendChild(t),e.open=function(e){if(null!==e){var t;if(void 0!==e.cssclass&&null!==e.cssclass&&i.setAttribute("class",e.cssclass),a.innerHTML="",void 0!==e.iframelink&&null!==e.iframelink&&0<e.iframelink.length?(a.innerHTML='<iframe id="ek-modal-iframe-loading"></iframe><iframe src='+e.iframelink+' id="ek-modal-iframe" style=\'display:none;\' onload="evalkit_modal_iframe();"></frame>',window.removeEventListener("resize",evalkit_modal_iframe_resize),window.addEventListener("resize",evalkit_modal_iframe_resize),evalkit_modal_iframe_resize(),document.getElementById("ek-modal-close").style.display="",document.getElementById("ek-modal-iframe-loading").contentWindow.document.write('<html><head></head><body style="text-align:center;"><img src="'+evalkit_setup.account_url+'/Media/Images/loadingd2l.gif" style="padding-top:10%;" /></body></html>')):a.innerHTML=e.body,void 0!==e.title&&null!==e.title?(o.innerHTML=e.title,o.style.display=""):o.style.display="none",s.setAttribute("class","ek-overlay-"+e.type),"blocker"===e.type?(0===(t=window.getComputedStyle(document.getElementById("header"),null).getPropertyValue("background-color")).length&&(t="rgb(57, 75, 88)"),s.style.background=t):s.style.background="",i.setAttribute("oncontextmenu","return false"),s.setAttribute("oncontextmenu","return false"),s.style.display="",i.style.display="",i.setAttribute("data-type",e.type),window.scrollTo(0,0),$("body").addClass("ek-modal-open"),setTimeout(function(){$("body").removeClass("ek-modal-open")},2e3),void 0!==e.buttons&&null!==e.buttons&&0<e.buttons.length){l.innerHTML="";for(var n=0;n<e.buttons.length;n++)0===n&&e.buttons[n].focus(),l.appendChild(e.buttons[n]);l.style.display=""}else l.innerHTML="",l.style.display="none";!0!==e.showClose&&(r.style.display="none"),!0===e.refreshOnClose?r.onclick=function(e){$(document).keypress(function(e){if(27===e.keyCode)return e.preventDefault(),!1}),ek_modal.close(),document.location.href=document.location.href}:r.onclick=function(e){ek_modal.close()}}},e.close=function(){$("body").removeClass("ek-modal-open"),s.style.display="none",i.style.display="none",a.innerHTML=""},document.body.appendChild(s),document.body.appendChild(i),e}();function evalkit_modal_iframe(e){var t=document.getElementById("ek-modal-iframe"),n=document.getElementById("ek-modal-iframe-loading");t.style.display="",n.style.display="none"}function evalkit_modal_iframe_resize(){var e=document.getElementById("ek-modal-iframe");null!==e&&e.setAttribute("height",window.innerHeight-180);e=document.getElementById("ek-modal-iframe-loading");null!==e&&e.setAttribute("height",window.innerHeight-180)}function evalkit_createCookie(e,t){var n=new Date,n=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());sessionStorage.setItem(e+"_E",n),sessionStorage.setItem(e,t)}function evalkit_readCookie(e){var t=sessionStorage.getItem(e+"_E");if(null===t)return sessionStorage.removeItem(e),null;var n=new Date;return 18e5<Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())-t?(sessionStorage.removeItem(e+"_E"),sessionStorage.removeItem(e),null):sessionStorage.getItem(e)}